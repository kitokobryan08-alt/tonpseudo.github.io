<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Architext</title>
  <style>
    body { font-family: sans-serif; margin: 0; background: #f5f5f5; }
    header, footer { background: #2a5298; color: white; padding: 20px; text-align: center; }
    section { padding: 20px; display: none; }
    .visible { display: block; }
    form { max-width: 400px; margin: 20px auto; background: white; padding: 20px; border-radius: 8px; }
    input, select, button { width: 100%; padding: 10px; margin-top: 10px; }
    .btn-logout { background: red; color: white; margin-top: 20px; }
  </style>
</head>
<body>

<header>
  <h1>Bienvenue sur Architext</h1>
</header>

<!-- Formulaire d'inscription / connexion -->
<section id="authSection" class="visible">
  <form id="authForm">
    <h2>Créer un compte ou se connecter</h2>
 <input type="email" id="email" placeholder="Email" required />
    <input type="password" id="password" placeholder="Mot de passe" required />
    <select id="role">
      <option value="utilisateur">Utilisateur</option>
      <option value="architecte">Architecte</option>
    </select>
    <button type="submit">Valider</button>
  </form>
</section>

<!-- Dashboard Utilisateur -->
<section id="userDashboard">
  <h2>Dashboard Utilisateur</h2>
  <p>Bienvenue dans votre espace personnel.</p>
  <button class="btn-logout" onclick="logout()">Se déconnecter</button>
</section>

<!-- Dashboard Architecte -->
<section id="architectDashboard">
  <h2>Dashboard Architecte</h2>
  <p>Bienvenue dans votre interface architecte.</p>
  <button class="btn-logout" onclick="logout()">Se déconnecter</button>
</section>

<footer>
  <p>&copy; 2025 BryLeb Créations - Tous droits réservés</p>
</footer>

<!-- Firebase SDKs -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
  import { getAuth, onAuthStateChanged, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-auth.js";
 import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyB_25LK7m2SXg4xAyaMXV18uU4b5-JPEHw",
    authDomain: "architext-9efb6.firebaseapp.com",
    projectId: "architext-9efb6",
    storageBucket: "architext-9efb6.appspot.com",
    messagingSenderId: "70580255187",
    appId: "1:70580255187:web:ee3591d6d3c2f52b491726"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth();
  const db = getFirestore();

  const authForm = document.getElementById('authForm');
  const emailInput = document.getElementById('email');
  const passwordInput = document.getElementById('password');
  const roleSelect = document.getElementById('role');

  const authSection = document.getElementById('authSection');
  const userDashboard = document.getElementById('userDashboard');
  const architectDashboard = document.getElementById('architectDashboard');

  authForm.addEventListener('submit', async (e) => {
    e.preventDefault();
    const email = emailInput.value;
    const password = passwordInput.value;
    const role = roleSelect.value;

    try {
      const userCredential = await createUserWithEmailAndPassword(auth, email, password);
      const user = userCredential.user;
 await setDoc(doc(db, "users", user.uid), { role });
    } catch (error) {
      try {
        await signInWithEmailAndPassword(auth, email, password);
      } catch (err) {
        alert("Erreur : " + err.message);
      }
    }
  });

  onAuthStateChanged(auth, async (user) => {
    if (user) {
      const docRef = doc(db, "users", user.uid);
      const docSnap = await getDoc(docRef);
      const role = docSnap.exists() ? docSnap.data().role : null;

      authSection.classList.remove("visible");
      userDashboard.style.display = "none";
      architectDashboard.style.display = "none";

      if (role === "utilisateur") {
        userDashboard.classList.add("visible");
      } else if (role === "architecte") {
        architectDashboard.classList.add("visible");
      }
    } else {
      authSection.classList.add("visible");
      userDashboard.classList.remove("visible");
      architectDashboard.classList.remove("visible");
    }
  });

  function logout() {
    signOut(auth);
  }
</script>

</body>
</html>
